var showOptionsPage;jQuery(function(a){showOptionsPage=function(b,c,d,e){tb_show(null,null,null),a("body").append("<div id='TB_load'><img src='"+tb_pathToImage+"' /></div>"),a("#TB_load").show();var f="";null!=d&&(f+="&connection="+encodeURIComponent(d)),"undefined"!=typeof e&&null!=e&&(f+="&blog_id="+Number(e)),a.post(ajaxurl,"action=publicize_"+b+"_options_page&_wpnonce="+c+f,function(c){a("#TB_load").remove();try{var d=jQuery.parseJSON(c);if(null!=d&&"object"==typeof d&&d.hasOwnProperty("fb_redirect"))return void(location.href=d.fb_redirect+"&redirect_uri="+encodeURIComponent(location.href))}catch(e){}if(""!=c){var f=a("input[name=wpas_ajax_blog_id]").val(),g=a('<div id="wpas-ajax-'+f+'" class="wrap"></div>').append(c);g.append('<a href="#TB_inline?thickbox&height=420&width=555&inlineId=wpas-ajax-'+f+'" id="wpas-click-'+f+'" class="new-thickbox" style="display: none;"></a>'),a("#wpas-message").html(g),tb_init("a.new-thickbox"),a("#wpas-click-"+f).click();var h=parseInt(a("#TB_ajaxContent").css("height")),i=a("#thickbox-content").height();if(h>i){var j=i+15;a("#TB_ajaxContent").css("height",j);var k=parseInt(a("#TB_window").css("margin-top"))+(h-j)/2+"px";a("#TB_window").css("margin-top",k)}a(".save-options").unbind("click").click(function(){var c=a("input[name='option']:checked"),d=a("input[name='global']:checked"),e=a(this).data("connection"),f=encodeURIComponent(c.val()),g=encodeURIComponent(c.attr("id")),h=encodeURIComponent(c.attr("data-type")),i=a(this).attr("rel"),j="off",k="";d.length&&(j="on",k=d.val()),a.post(ajaxurl,"action=publicize_"+b+"_options_save&connection="+e+"&selected_id="+g+"&token="+f+"&type="+h+"&_wpnonce="+i+"&global="+j+"&global_nonce="+k,function(){var a;tb_remove(),a=document.location.search.match(/frame-nonce=([^&]+)/),/inside-newdash=1/.test(document.location.search)&&a?document.location="options-general.php?page=sharing&inside-newdash=1&frame-nonce"+a[1]:top.location="options-general.php?page=sharing"})})}},"html")},a("body").append('<div id="wpas-message" style="display: none"></div>');a("#wpas-message");a(".wpas-posts").change(function(){var b=a(this).parents("td:first").find(":input"),c=this,d=b.filter("[name=wpas_ajax_blog_id]").val();a("#waiting_"+d).show(),a.post(ajaxurl,b.serialize()+"&action=wpas_post",function(a){myblogsResponse.call(c,d,a)},"html")}),a(".options").unbind("click").bind("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this).attr("class").replace("options ",""),d=null;"undefined"!=typeof a(this).attr("id")&&(d=parseInt(a(this).attr("id").replace("options-","")));var e=a(this).attr("href").replace("#nonce=",""),f=a(this).data("connection");showOptionsPage.call(this,c,e,f,d)}),publicizeConnTestStart=function(){a(".pub-connection-test").addClass("test-in-progress"),a.post(ajaxurl,{action:"test_publicize_conns"},publicizeConnTestComplete)},publicizeConnRefreshClick=function(a){a.preventDefault();var b=a.currentTarget.href,c=a.currentTarget.title,d=window.open(b,c,""),e=window.setInterval(function(){d.closed!==!1&&(window.clearInterval(e),publicizeConnTestStart())},500)},publicizeConnTestComplete=function(b){a(".pub-connection-test").removeClass("test-in-progress"),a.each(b.data,function(b,c){var d="#pub-connection-test-"+c.connectionID;c.connectionTestPassed?a(d).addClass("test-passed").html("").removeClass("test-failed"):(a(d).addClass("test-failed").html('<p><span class="pub-connection-error">'+c.connectionTestMessage+"</span></p>").removeClass("test-passed"),c.userCanRefresh&&(a(d).append("<br/>"),a("<a/>",{"class":"pub-refresh-button button",title:c.refreshText,href:c.refreshURL,text:c.refreshText,target:"_refresh_"+c.serviceName}).appendTo(d).click(publicizeConnRefreshClick)))})},a(document).ready(function(){a(".pub-connection-test").length&&publicizeConnTestStart()})});