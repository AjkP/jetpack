!function(a){a(document).ready(function(){function b(){a(".preview a.sharing-anchor").unbind("mouseenter mouseenter").hover(function(){if(a(this).data("hasappeared")!==!0){var b=a(".sharing-hidden .inner"),c=a(this).parents("li"),d=setTimeout(function(){a(b).css({left:a(c).position().left+"px",top:a(c).position().top+a(c).height()+3+"px"}).slideDown(200,function(){a(c).data("hasappeared",!0).data("hasoriginal",!0).data("hasitem",!1),a(b).mouseleave(d).mouseenter(e),a(c).mouseleave(f).mouseenter(g),a(c).click(h)});var d=function(){if(a(c).data("hasitem",!1),a(c).data("hasoriginal")===!1){var b=setTimeout(h,800);a(c).data("timer2",b)}},e=function(){a(c).data("hasitem",!0),clearTimeout(a(c).data("timer2"))},f=function(){if(a(c).data("hasoriginal",!1),a(c).data("hasitem")===!1){var b=setTimeout(h,800);a(c).data("timer2",b)}},g=function(){a(c).data("hasoriginal",!0),clearTimeout(a(c).data("timer2"))},h=function(){return b.slideUp(200),a(c).unbind("mouseleave",f).unbind("mouseenter",g),a(b).unbind("mouseleave",d).unbind("mouseenter",d),a(c).data("hasappeared",!1),a(c).unbind("click",h),!1}},200);a(this).data("timer",d)}},function(){clearTimeout(a(this).data("timer")),a(this).data("timer",!1)})}function c(){var c=a("#button_style").val();a("#live-preview ul.preview li").remove(),(""!=a("#save-enabled-shares input[name=visible]").val()||""!=a("#save-enabled-shares input[name=hidden]").val())&&a("#live-preview ul.preview").append(a("#live-preview ul.archive .sharing-label").clone()),a("ul.services-enabled li").each(function(){if(a(this).hasClass("service")){var b=a(this).attr("id");a("#live-preview ul.preview").append(a("#live-preview ul.archive li.preview-"+b).clone())}}),""!=a("#save-enabled-shares input[name=hidden]").val()&&(a("#live-preview ul.preview").append(a("#live-preview ul.archive .share-more").parent().clone()),a(".sharing-hidden ul li").remove(),a("ul.services-hidden li").each(function(){if(a(this).hasClass("service")){var b=a(this).attr("id");a(".sharing-hidden .inner ul").append(a("#live-preview ul.archive .preview-"+b).clone())}}),b()),a("#live-preview div.sharedaddy").removeClass("sd-social-icon"),a("#live-preview li.advanced").removeClass("no-icon"),"icon"==c?(a("#live-preview ul.preview div span").html("&nbsp;").parent().addClass("no-text"),a("#live-preview div.sharedaddy").addClass("sd-social-icon")):"official"==c?a("#live-preview ul.preview .advanced").each(function(){a(this).hasClass("preview-press-this")||a(this).hasClass("preview-email")||a(this).hasClass("preview-print")||a(this).hasClass("share-custom")||a(this).find(".option a span").html("").parent().removeClass("sd-button").parent().attr("class","option option-smart-on")}):"text"==c&&a("#live-preview li.advanced").addClass("no-icon")}function d(a){jQuery("."+a+"-extra-options").css({backgroundColor:"#ffffcc"}).fadeIn()}function e(a){jQuery("."+a+"-extra-options").fadeOut("slow")}function f(){a("#enabled-services h3 img").show(),a("#enabled-services ul.services-enabled li.service").length>0?a("#drag-instructions").hide():a("#drag-instructions").show(),a("#enabled-services li.service").length>0?a("#live-preview .services h2").hide():a("#live-preview .services h2").show();var b=[],f=[];a("ul.services-enabled li").each(function(){a(this).hasClass("service")&&(b[b.length]=a(this).attr("id"),d(a(this).attr("id")))}),a("ul.services-available li").each(function(){a(this).hasClass("service")&&e(a(this).attr("id"))}),a("ul.services-hidden li").each(function(){a(this).hasClass("service")&&(f[f.length]=a(this).attr("id"),d(a(this).attr("id")))}),a("#save-enabled-shares input[name=visible]").val(b.join(",")),a("#save-enabled-shares input[name=hidden]").val(f.join(",")),c(),a("#save-enabled-shares").ajaxSubmit(function(){a("#enabled-services h3 img").hide()})}function g(a,b){var c=a.parent(),d=c.find("li"),e=d.index(a)+1,g=d.length-1;if(!c.hasClass("services-available")){if("left"===b){if(1===e)return;var h=a.prev(),i=a.detach();h.before(i),h.prev().focus()}if("right"===b){if(e===g)return;var j=a.next(),i=a.detach();j.after(i),j.next().focus()}f()}}function h(b){var c,d=b.parent();c=d.hasClass("services-available")?"services-enabled":d.hasClass("services-enabled")?"services-hidden":"services-available";var e=b.detach();a("."+c).prepend(e).find("li:first-child").focus(),f()}function i(){a("#services-config a.remove").unbind("click").click(function(){var b=a(this).parent().next();return a(this).parents("li:first").css("backgroundImage",'url("'+sharing_loading_icon+'")'),b.ajaxSubmit(function(){b.parents("li:first").fadeOut(function(){a(this).remove(),c()})}),!1})}a("#enabled-services .services ul").sortable({receive:function(){f()},stop:function(){f(),a("li.service").enableSelection()},over:function(){a(this).find("ul").addClass("dropping"),a("#enabled-services li.end-fix").remove(),a("#enabled-services ul").append('<li class="end-fix"></li>')},out:function(){a(this).find("ul").removeClass("dropping"),a("#enabled-services li.end-fix").remove(),a("#enabled-services ul").append('<li class="end-fix"></li>')},helper:function(a,b){return b.find(".advanced-form").hide(),b.clone()},start:function(){a(".advanced-form").hide(),a("li.service").disableSelection()},placeholder:"dropzone",opacity:.8,delay:150,forcePlaceholderSize:!0,items:"li",connectWith:"#available-services ul, #enabled-services .services ul",cancel:".advanced-form"}),a("#available-services ul").sortable({opacity:.8,delay:150,cursor:"move",connectWith:"#enabled-services .services ul",placeholder:"dropzone",forcePlaceholderSize:!0,start:function(){a(".advanced-form").hide()}}),a(".service").on("keydown",function(b){switch(b.keyCode){case 13:h(a(this));break;case 32:h(a(this));break;case 37:g(a(this),"left");break;case 39:g(a(this),"right");break;default:return!0}b.preventDefault()}),a(".preview-hidden a").click(function(){return a(this).parent().find(".preview").toggle(),!1}),a("#new-service form").ajaxForm({beforeSubmit:function(){a("#new-service-form .error").hide(),a("#new-service-form img").show(),a("#new-service-form input[type=submit]").prop("disabled",!0)},success:function(b){a("#new-service-form img").hide(),"1"==b?(a("#new-service-form .inerror").removeClass("inerror").addClass("error"),a("#new-service-form .error").show(),a("#new-service-form input[type=submit]").prop("disabled",!1)):document.location=document.location.href.replace(/&create_new_service=true/i,"")}}),a("#button_style").change(function(){return c(),!0}).change(),a("input[name=sharing_label]").blur(function(){a("#live-preview h3.sd-title").text(a("<div/>").text(a(this).val()).html())}),i(),b()})}(jQuery);