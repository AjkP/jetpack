window.FB||(window.FB={}),GrunionFB_i18n=jQuery.extend({nameLabel:"Name",emailLabel:"Email",urlLabel:"Website",commentLabel:"Comment",newLabel:"New Field",optionsLabel:"Options",optionLabel:"Option",firstOptionLabel:"First option",problemGeneratingForm:"Oops, there was a problem generating your form.  You'll likely need to try again.",moveInstructions:"Drag up or down\nto re-arrange",moveLabel:"move",editLabel:"edit",savedMessage:"Saved successfully",requiredLabel:"(required)",exitConfirmMessage:"Are you sure you want to exit the form editor without saving?  Any changes you have made will be lost."},GrunionFB_i18n),GrunionFB_i18n.moveInstructions=GrunionFB_i18n.moveInstructions.replace("\n","<br />"),FB.span=jQuery("<span>"),FB.esc_html=function(a){return FB.span.text(a).html()},FB.esc_attr=function(a){return a=FB.esc_html(a),a.replace('"',"&quot;").replace("'","&#039;")},FB.ContactForm=function(){function a(){try{C++,D>=C?(jQuery("#fb-extra-fields").append('<div id="fb-new-field'+C+'" fieldid="'+C+'" class="fb-new-fields"><div class="fb-fields"><div id="'+C+'" class="fb-remove"></div><label fieldid="'+C+'" for="fb-field'+C+'"><span class="label-text">'+GrunionFB_i18n.newLabel+'</span> </label><input type="text" id="fb-field'+C+'" disabled="disabled" /></div></div>'),z.fields[C]={label:GrunionFB_i18n.newLabel,type:"text",required:!1,options:[],order:"5"},C===D&&jQuery("#fb-new-field").hide(),F=0,E={},jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-options").hide(),jQuery("#fb-new-label").val(GrunionFB_i18n.newLabel),jQuery("#fb-new-type").val("text"),jQuery("#fb-field-id").val(C),setTimeout(function(){jQuery("#fb-new-label").focus().select()},100)):jQuery("#fb-new-field").hide()}catch(a){B&&console.log("addField(): "+a)}}function b(){try{F=jQuery("#fb-new-options .fb-options").length;var a=jQuery("#fb-field-id").val(),b=jQuery("#fb-new-type").val();"radio"===b?(jQuery("#fb-new-options").append('<div id="fb-option-box-'+F+'" class="fb-new-fields"><span optionid="'+F+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+F+'" optionid="'+F+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>'),jQuery("#fb-new-field"+a+" .fb-fields").append('<div id="fb-radio-'+a+"-"+F+'"><input type="radio" disabled="disabled" id="fb-field'+a+'" name="radio-'+a+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')):(jQuery("#fb-new-options").append('<div id="fb-option-box-'+F+'" class="fb-new-fields"><span optionid="'+F+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+F+'" optionid="'+F+'" value="" class="fb-options" /><div>'),jQuery("#fb-field"+a).append('<option id="fb-'+a+"-"+F+'" value="'+a+"-"+F+'"></option>')),z.fields[a].options[F]="",jQuery("#fb-option"+F).focus().select()}catch(c){B&&console.log("addOption(): "+c)}}function c(){try{z.to&&jQuery("#fb-field-my-email").val(z.to),z.subject&&jQuery("#fb-field-subject").val(z.subject),jQuery.each(z.fields,function(a,b){jQuery("#fb-extra-fields").before('<div class="fb-new-fields ui-state-default" fieldid="'+a+'" id="fb-new-field'+a+'"><div class="fb-fields"></div></div>'),jQuery("#fb-field-id").val(a),E[a]={},E[a].options=[],("radio"===b.type||"select"===b.type)&&jQuery.each(b.options,function(b,c){E[a].options[b]=c}),x(b.type,b.label,b.required)})}catch(a){B&&console.log("buildPreview(): "+a)}}function d(a,b){try{for(var c="",d=0;d<E[a].options.length;d++)void 0!==E[a].options[d]&&(c="radio"===b?c+'<div id="fb-radio-'+a+"-"+d+'"><input type="radio" id="fb-field'+a+'" name="radio-'+a+'" /><span>'+FB.esc_html(E[a].options[d])+'</span><div class="clear"></div></div>':c+'<option id="fb-'+a+"-"+d+'" value="'+a+"-"+d+'">'+FB.esc_html(E[a].options[d])+"</option>");return c}catch(e){B&&console.log("customOptions(): "+e)}}function e(a){try{C--;var b=a.attr("id");delete z.fields[b],jQuery("#"+b).parent().parent().remove(),D>=C&&jQuery("#fb-new-field").show()}catch(c){B&&console.log("deleteField(): "+c)}}function f(a){try{scroll(0,0),setTimeout(function(){jQuery("#fb-new-label").focus().select()},100);var b=a.parent().attr("fieldid");k(b)}catch(c){B&&console.log("editField(): "+c)}}function g(){try{jQuery.post(ajaxurl,z,function(a){y=a})}catch(a){alert(GrunionFB_i18n.problemGeneratingForm),B&&console.log("grabShortcode(): "+a)}}function h(){jQuery("#fb-desc").hide(),jQuery("#fb-add-field").show()}function i(){try{return jQuery("#TB_imageOff",window.parent.document).unbind("click"),jQuery("#TB_closeWindowButton",window.parent.document).unbind("click"),jQuery("#TB_window",window.parent.document).fadeOut("fast"),jQuery("#TB_window,#TB_overlay,#TB_HideSelect",window.parent.document).trigger("unload").unbind().remove(),jQuery("#TB_load",window.parent.document).remove(),"undefined"==typeof window.parent.document.body.style.maxHeight&&(jQuery("body","html",window.parent.document).css({height:"auto",width:"auto"}),jQuery("html",window.parent.document).css("overflow","")),window.parent.document.onkeydown="",window.parent.document.onkeyup="",!1}catch(a){B&&console.log("hidePopup(): "+a)}}function j(a,b){try{"show"===a?(jQuery(".fb-edit-field").is(":visible")&&jQuery(".fb-edit-field").remove(),b.find("label").prepend('<span class="right fb-edit-field" style="font-weight: normal;"><a href="" class="fb-reorder"><div style="display: none;">'+GrunionFB_i18n.moveInstructions+"</div>"+GrunionFB_i18n.moveLabel+'</a>&nbsp;&nbsp;<span style="color: #C7D8DE;">|</span>&nbsp;&nbsp;<a href="" class="fb-edit">'+GrunionFB_i18n.editLabel+"</a></span>")):jQuery(".fb-edit-field").remove()}catch(c){B&&console.log("hideShowEditLink(): "+c)}}function k(a){try{var b=z.fields[a].type;if(jQuery("#fb-options").hide(),jQuery("#fb-field-id").val(a),jQuery("#fb-new-label").val(z.fields[a].label),jQuery("#fb-new-type").val(z.fields[a].type),z.fields[a].required?jQuery("#fb-new-required").prop("checked",!0):jQuery("#fb-new-required").prop("checked",!1),"select"===b||"radio"===b){var c=z.fields[a].options;jQuery("#fb-options").show(),jQuery("#fb-new-options").html("");for(var d=0;d<c.length;d++)void 0!==c[d]&&jQuery("#fb-new-options").append("radio"===b?'<div id="fb-option-box-'+d+'" class="fb-new-fields"><span optionid="'+d+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+d+'" optionid="'+d+'" value="'+FB.esc_attr(z.fields[a].options[d])+'" class="fb-options" /><div>':'<div id="fb-option-box-'+d+'" class="fb-new-fields"><span optionid="'+d+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+d+'" optionid="'+d+'" value="'+FB.esc_attr(z.fields[a].options[d])+'" class="fb-options" /><div>')}h()}catch(e){B&&console.log("loadFieldEditor(): "+e)}}function l(a){try{z.fields={},a?(jQuery.each(a.fields,function(a,b){1===parseInt(b.required,10)&&(b.required="true"),z.fields[a]=b}),z.to=a.to,z.subject=a.subject):z.fields=A}catch(b){B&&console.log("parseShortcode(): "+b)}}function m(a){try{var b=jQuery("#fb-field-id").val(),c=jQuery("#fb-option"+a).val(),d=jQuery("#fb-new-type").val();jQuery("#fb-option-box-"+a).remove(),"radio"===d?jQuery("#fb-radio-"+b+"-"+a).remove():jQuery("#fb-"+b+"-"+a).remove();var e=z.fields[b].options.indexOf(c);-1!==e&&z.fields[b].options.splice(e,1)}catch(f){B&&console.log("removeOption(): "+f)}}function n(){try{var a=jQuery("#fb-field-id").val();jQuery("#fb-options").hide(),void 0===E[a]&&(E[a]={}),E[a].options=z.fields[a].options,z.fields[a].options=[]}catch(b){B&&console.log("removeOptions(): "+b)}}function o(){try{jQuery("div#sortable div.fb-new-fields").each(function(a){var b=jQuery(this).attr("fieldid");z.fields[b].order=a}),jQuery.post(ajaxurl,z,function(a){var b=jQuery("#edButtonPreview",window.parent.document).hasClass("active");b||(b=jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active"));var c,d=window.dialogArguments||opener||parent||top;b?c=d.tinyMCE.activeEditor.getContent():(c=jQuery("#editorcontainer textarea",window.parent.document).val(),"string"!=typeof c&&(c=jQuery(".wp-editor-area",window.parent.document).val()));var e=new RegExp("\\[contact-form\\b.*?\\/?\\](?:[\\s\\S]+?\\[\\/contact-form\\])?");if(a=a.replace(/\n/g," "),c.match(e))b?d.tinyMCE.activeEditor.execCommand("mceSetContent",!1,c.replace(e,a)):jQuery("#content",window.parent.document).val(c.replace(e,a));else try{d.send_to_editor(a)}catch(f){b?d.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,a):jQuery("#content",window.parent.document).val(c+a)}i()})}catch(a){B&&console.log("sendShortcodeToEditor(): "+a)}}function p(){jQuery("#fb-desc").show(),jQuery("#fb-add-field").hide()}function q(a){try{var b=a?a:GrunionFB_i18n.savedMessage;jQuery("#fb-success").text(b),jQuery("#fb-success").slideDown("fast"),setTimeout(function(){jQuery("#fb-success").slideUp("fast")},2500)}catch(c){B&&console.log("showAndHideMessage(): "+c)}}function r(a){try{"preview"===a?(jQuery("#tab-preview a").addClass("current"),jQuery("#tab-settings a").removeClass("current"),jQuery("#fb-preview-form, #fb-desc").show(),jQuery("#fb-email-settings, #fb-email-desc").hide()):(jQuery("#tab-preview a").removeClass("current"),jQuery("#tab-settings a").addClass("current"),jQuery("#fb-preview-form, #fb-desc, #fb-add-field").hide(),jQuery("#fb-email-settings, #fb-email-desc").show(),jQuery("#fb-field-my-email").focus().select())}catch(b){B&&console.log("switchTabs(): "+b)}}function s(){try{var a=jQuery("#fb-field-id").val(),b=jQuery("#fb-new-label").val();jQuery("#fb-new-field"+a+" label .label-text").text(0===b.length?GrunionFB_i18n.newLabel:b),z.fields[a].label=b}catch(c){B&&console.log("updateLabel(): "+c)}}function t(){try{var a=jQuery("#fb-field-my-email").val();z.to=a}catch(b){B&&console.log("updateMyEmail(): "+b)}}function u(a){try{var b=jQuery("#fb-field-id").val(),c=a.attr("optionid"),d=a.val(),e=jQuery("#fb-new-type").val();"radio"===e?jQuery("#fb-radio-"+b+"-"+c+" span").text(d):jQuery("#fb-"+b+"-"+c).text(d),z.fields[b].options[c]=d}catch(f){B&&console.log("updateOption(): "+f)}}function v(){try{var a=jQuery("#fb-field-id").val(),b=jQuery("#fb-new-required").is(":checked");b?(z.fields[a].required=!0,jQuery("#fb-new-field"+a+" label").append('<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>")):(z.fields[a].required=!1,jQuery("#fb-new-field"+a+" label .label-required").remove())}catch(c){B&&console.log("updateRequired(): "+c)}}function w(){try{var a=jQuery("#fb-field-subject").val();z.subject=a}catch(b){B&&console.log("updateSubject(): "+b)}}function x(a,b,c){try{var e=jQuery("#fb-field-id").val();a||(a=jQuery("#fb-new-type").val()),b||(b=jQuery("#fb-new-field"+e+" .label-text").text());var f=c?'<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>":"",g='<label fieldid="'+e+'" for="fb-field'+e+'"><span class="label-text">'+FB.esc_html(b)+"</span>"+f+"</label>",h='<input type="radio" name="radio-'+e+'" id="fb-field'+e+' "disabled="disabled" />',i='<label fieldid="'+e+'" for="fb-field'+e+'" class="fb-radio-label"><span class="label-text">'+FB.esc_html(b)+"</span>"+f+"</label>",j='<div class="fb-remove fb-remove-small" id="'+e+'"></div>',k='<div class="fb-remove" id="'+e+'"></div>',l='<input type="checkbox" id="fb-field'+e+'" "disabled="disabled" />',m='<input type="text" id="fb-field'+e+'" "disabled="disabled" />',o='<textarea id="fb-field'+e+'" "disabled="disabled"></textarea>',p='<div class="clear"></div>',q='<select id="fb-field'+e+'" fieldid="'+e+'"><option id="fb-'+e+"-"+F+'" value="'+e+"-"+F+'">'+GrunionFB_i18n.firstOptionLabel+"</option></select>";switch(a){case"checkbox":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(j+l+i+p);break;case"email":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+m);break;case"name":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+m);break;case"radio":jQuery("#fb-new-field"+e+" .fb-fields").html(g+j+'<div fieldid="'+e+'" id="fb-custom-radio'+e+'"></div>'),void 0!==E[e]&&0!==E[e].options.length?(z.fields[e].options=E[e].options,jQuery("#fb-custom-radio"+e).append(d(e,a))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-custom-radio"+e).append('<div id="fb-radio-'+e+'-0">'+h+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+p+"</div>"),z.fields[e].options[F]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout(function(){jQuery("#fb-option0").focus().select()},100);break;case"select":jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+q),void 0!==E[e]&&0!==E[e].options.length?(z.fields[e].options=E[e].options,jQuery("#fb-field"+e).html(d(e,a))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),z.fields[e].options[F]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout(function(){jQuery("#fb-option0").focus().select()},100);break;case"text":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+m);break;case"textarea":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+o);break;case"url":n(),jQuery("#fb-new-field"+e+" .fb-fields").html(k+g+m)}z.fields[e].type=a}catch(r){B&&console.log("updateType(): "+r)}}var y,z={action:"grunion_shortcode",_ajax_nonce:ajax_nonce_shortcode,to:"",subject:"",fields:{}},A={name:{label:GrunionFB_i18n.nameLabel,type:"name",required:!0,options:[],order:"1"},email:{label:GrunionFB_i18n.emailLabel,type:"email",required:!0,options:[],order:"2"},url:{label:GrunionFB_i18n.urlLabel,type:"url",required:!1,options:[],order:"3"},comment:{label:GrunionFB_i18n.commentLabel,type:"textarea",required:!0,options:[],order:"4"}},B=!1,C=0,D=5,E={},F=0;return{resizePop:function(){try{var a=jQuery("body",window.parent.document).width(),b=jQuery("body",window.parent.document).height(),c="undefined"==typeof document.body.style.maxHeight;jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("width","768px"),jQuery("#TB_window",window.parent.document).css({left:(a-768)/2+"px",top:"23px",position:"absolute",marginLeft:"0"}),c||jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("height",b-73+"px")}catch(d){B&&console.log("resizePop(): "+d)}},init:function(){window.parent.scroll(0,0);var d;if(jQuery("#edButtonPreview",window.parent.document).hasClass("active")||jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active")){var k=window.dialogArguments||opener||parent||top;d=k.tinyMCE.activeEditor.getContent()}else d=jQuery("#content",window.parent.document).val();var n={action:"grunion_shortcode_to_json",_ajax_nonce:ajax_nonce_json,post_id:postId,content:d},y=jQuery(document);jQuery.post(ajaxurl,n,function(a){l(jQuery.parseJSON(a)),c()}),jQuery(".fb-add-field").click(function(){return a(),h(),!1}),jQuery("#fb-new-label").keyup(function(){s()}),jQuery("#fb-new-type").change(function(){x()}),jQuery("#fb-new-required").click(function(){v()}),y.on("click",".fb-remove",function(){p(),e(jQuery(this)),g()}),jQuery("#fb-preview").submit(function(){return o(),!1}),jQuery("#TB_overlay, #TB_closeWindowButton",window.parent.document).mousedown(function(){confirm(GrunionFB_i18n.exitConfirmMessage)&&i()}),y.on("click","#fb-another-option",function(){b()}),y.on("keyup",".fb-options",function(){u(jQuery(this))}),y.on("click",".fb-remove-option",function(){m(jQuery(this).attr("optionid"))}),jQuery("#tab-preview a").click(function(){return r("preview"),!1}),jQuery("#fb-prev-form").click(function(){return r("preview"),q(GrunionFB_i18n.savedMessage),!1}),jQuery("#tab-settings a").click(function(){return r(),!1}),jQuery("#fb-field-my-email").blur(function(){t()}),jQuery("#fb-field-subject").blur(function(){w()}),y.on("mouseenter",".fb-form-case .fb-new-fields",function(){j("show",jQuery(this))}),y.on("mouseleave",".fb-form-case .fb-new-fields",function(){return j("hide"),!1}),y.on("click",".fb-edit-field",function(){return f(jQuery(this)),!1}),y.on("click",".fb-edit-field .fb-reorder",function(){return!1}),y.on("click","#fb-save-field",function(){return p(),q(),!1}),jQuery("#fb-feedback").click(function(){var a=jQuery(this).attr("href");return window.parent.location=a,!1}),jQuery("#sortable").sortable({axis:"y",handle:".fb-reorder",revert:!0,start:function(){jQuery(".fb-edit-field").hide()}}),jQuery("#draggable").draggable({axis:"y",handle:".fb-reorder",connectToSortable:"#sortable",helper:"clone",revert:"invalid"})}}}();