jQuery(function(a){var b={init:function(){a(document).on("dragover.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragOver),a(document).on("dragleave.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragLeave),a(document).on("drop.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDrop),a("body").append(a('<div id="jetpack-comic-drop-zone"><p class="dragging" /><p class="uploading" /></div>')),a("#jetpack-comic-drop-zone").find(".dragging").text(Jetpack_Comics_Options.labels.dragging).end().find(".uploading").text(Jetpack_Comics_Options.labels.uploading).prepend(a('<span class="spinner"/>')),"FileReader"in window&&"File"in window||(a("#jetpack-comic-drop-zone .dragging").text(Jetpack_Comics_Options.labels.unsupported),a(document).off("drop.jetpack-comics").on("drop.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragLeave))},filterImageFiles:function(a){for(var b=[],c=0,d=a.length;d>c;c++)a[c].type.match(/^image\//i)&&b.push(a[c]);return b},dragTimeout:null,onDragOver:function(c){c.preventDefault(),clearTimeout(b.dragTimeout),a("body").addClass("dragging")},onDragLeave:function(){clearTimeout(b.dragTimeout),b.dragTimeout=setTimeout(function(){a("body").removeClass("dragging")},100)},onDrop:function(c){c.preventDefault(),c.stopPropagation(),c.originalEvent.stopPropagation(),c.originalEvent.preventDefault();var d=b.filterImageFiles(c.originalEvent.dataTransfer.files);if(a("body").removeClass("dragging"),0==d.length)return void alert(Jetpack_Comics_Options.labels.invalidUpload);a("body").addClass("uploading");for(var e=new FormData,f=0,g=d.length;g>f;f++)e.append("image_"+f,d[f]);a("#jetpack-comic-drop-zone .uploading .spinner").spin(),a.ajax({url:Jetpack_Comics_Options.writeURL+"&nonce="+Jetpack_Comics_Options.nonce,data:e,processData:!1,contentType:!1,type:"POST",dataType:"json",xhrFields:{withCredentials:!0}}).done(function(b){a("#jetpack-comic-drop-zone .uploading").text(Jetpack_Comics_Options.labels.processing),"url"in b?document.location.href=b.url:"error"in b&&(alert(b.error),a("body").removeClass("uploading"))}).fail(function(){alert(Jetpack_Comics_Options.labels.error)})}};b.init()});