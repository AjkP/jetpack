var AtD={rpc:"",rpc_css:"http://www.polishmywriting.com/atd-jquery/server/proxycss.php?data=",rpc_css_lang:"en",api_key:"",i18n:{},listener:{}};AtD.getLang=function(a,b){return window.AtD_l10n_r0ar&&window.AtD_l10n_r0ar[a]||b},AtD.addI18n=function(a){window.AtD_l10n_r0ar=a},AtD.setIgnoreStrings=function(a){AtD.core.setIgnoreStrings(a)},AtD.showTypes=function(a){AtD.core.showTypes(a)},AtD.checkCrossAJAX=function(a,b){"undefined"!=typeof AtD_proofread_click_count&&AtD_proofread_click_count++,AtD.callback_f=b,AtD.remove(a);var c=jQuery("#"+a),d=jQuery.trim(c.html());return d=d.replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&"),d=encodeURIComponent(d.replace(/\%/g,"%25")),d.length>2e3&&"Microsoft Internet Explorer"===navigator.appName||d.length>7800?void(void 0!==b&&void 0!==b.error&&b.error("Maximum text length for this browser exceeded")):void CSSHttpRequest.get(AtD.rpc_css+d+"&lang="+AtD.rpc_css_lang+"&nocache="+(new Date).getTime(),function(b){var c;if("Microsoft Internet Explorer"===navigator.appName?(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(b)):c=(new DOMParser).parseFromString(b,"text/xml"),AtD.core.hasErrorMessage(c))return void(void 0!==AtD.callback_f&&void 0!==AtD.callback_f.error&&AtD.callback_f.error(AtD.core.getErrorMessage(c)));AtD.container=a;var d=Number(AtD.processXML(a,c));void 0!==AtD.callback_f&&void 0!==AtD.callback_f.ready&&AtD.callback_f.ready(d),0===d&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(d),AtD.counter=d,AtD.count=d})},AtD.check=function(a,b){"undefined"!=typeof AtD_proofread_click_count&&AtD_proofread_click_count++,AtD.callback_f=b,AtD.remove(a);var c=jQuery("#"+a),d=jQuery.trim(c.html());d=d.replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&"),d=encodeURIComponent(d),jQuery.ajax({type:"POST",url:AtD.rpc+"/checkDocument",data:"key="+AtD.api_key+"&data="+d,format:"raw",dataType:jQuery.browser.msie?"text":"xml",error:function(a,b,c){void 0!==AtD.callback_f&&void 0!==AtD.callback_f.error&&AtD.callback_f.error(b+": "+c)},success:function(b){var c;if("string"==typeof b?(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(b)):c=b,AtD.core.hasErrorMessage(c))return void(void 0!==AtD.callback_f&&void 0!==AtD.callback_f.error&&AtD.callback_f.error(AtD.core.getErrorMessage(c)));AtD.container=a;var d=Number(AtD.processXML(a,c));void 0!==AtD.callback_f&&void 0!==AtD.callback_f.ready&&AtD.callback_f.ready(d),0===d&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(d),AtD.counter=d,AtD.count=d}})},AtD.remove=function(a){AtD._removeWords(a,null)},AtD.clickListener=function(a){AtD.core.isMarkedNode(a.target)&&AtD.suggest(a.target)},AtD.processXML=function(a,b){var c=AtD.core.processXML(b);return c.count>0&&(c.count=AtD.core.markMyWords(jQuery("#"+a).contents(),c.errors)),jQuery("#"+a).unbind("click",AtD.clickListener),jQuery("#"+a).click(AtD.clickListener),c.count},AtD.useSuggestion=function(a){this.core.applySuggestion(AtD.errorElement,a),AtD.counter--,0===AtD.counter&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(AtD.count)},AtD.editSelection=function(){var a=AtD.errorElement.parent();void 0!==AtD.callback_f&&void 0!==AtD.callback_f.editSelection&&AtD.callback_f.editSelection(AtD.errorElement),AtD.errorElement.parent()!==a&&(AtD.counter--,0===AtD.counter&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(AtD.count))},AtD.ignoreSuggestion=function(){AtD.core.removeParent(AtD.errorElement),AtD.counter--,0===AtD.counter&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(AtD.count)},AtD.ignoreAll=function(a){var b=AtD.errorElement.text(),c=AtD._removeWords(a,b);AtD.counter-=c,0===AtD.counter&&void 0!==AtD.callback_f&&void 0!==AtD.callback_f.success&&AtD.callback_f.success(AtD.count),void 0!==AtD.callback_f&&void 0!==AtD.callback_f.ignore&&(AtD.callback_f.ignore(b),AtD.core.setIgnoreStrings(b))},AtD.explainError=function(){void 0!==AtD.callback_f&&void 0!==AtD.callback_f.explain&&AtD.callback_f.explain(AtD.explainURL)},AtD.suggest=function(a){var b;0===jQuery("#suggestmenu").length?(b=jQuery('<div id="suggestmenu"></div>'),b.prependTo("body")):(b=jQuery("#suggestmenu"),b.hide());var c=AtD.core.findSuggestion(a);if(AtD.errorElement=jQuery(a),b.empty(),void 0===c)b.append("<strong>"+AtD.getLang("menu_title_no_suggestions","No suggestions")+"</strong>");else if(0===c.suggestions.length)b.append("<strong>"+c.description+"</strong>");else{b.append("<strong>"+c.description+"</strong>");for(var d=0;d<c.suggestions.length;d++)!function(a){b.append("<a href=\"javascript:AtD.useSuggestion('"+a.replace(/'/,"\\'")+"')\">"+a+"</a>")}(c.suggestions[d])}void 0!==AtD.callback_f&&void 0!==AtD.callback_f.explain&&void 0!==c.moreinfo&&(b.append('<a href="javascript:AtD.explainError()" class="spell_sep_top">'+AtD.getLang("menu_option_explain","Explain...")+"</a>"),AtD.explainURL=c.moreinfo),b.append('<a href="javascript:AtD.ignoreSuggestion()" class="spell_sep_top">'+AtD.getLang("menu_option_ignore_once","Ignore suggestion")+"</a>"),void 0!==AtD.callback_f&&void 0!==AtD.callback_f.editSelection?(b.append(void 0!==AtD.callback_f&&void 0!==AtD.callback_f.ignore?"<a href=\"javascript:AtD.ignoreAll('"+AtD.container+"')\">"+AtD.getLang("menu_option_ignore_always","Ignore always")+"</a>":"<a href=\"javascript:AtD.ignoreAll('"+AtD.container+"')\">"+AtD.getLang("menu_option_ignore_all","Ignore all")+"</a>"),b.append("<a href=\"javascript:AtD.editSelection('"+AtD.container+'\')" class="spell_sep_bottom spell_sep_top">'+AtD.getLang("menu_option_edit_selection","Edit Selection...")+"</a>")):b.append(void 0!==AtD.callback_f&&void 0!==AtD.callback_f.ignore?"<a href=\"javascript:AtD.ignoreAll('"+AtD.container+'\')" class="spell_sep_bottom">'+AtD.getLang("menu_option_ignore_always","Ignore always")+"</a>":"<a href=\"javascript:AtD.ignoreAll('"+AtD.container+'\')" class="spell_sep_bottom">'+AtD.getLang("menu_option_ignore_all","Ignore all")+"</a>");var e=jQuery(a).offset(),f=jQuery(a).width();f>100&&(f=50),jQuery(b).css({left:e.left+f+"px",top:e.top+"px"}),jQuery(b).fadeIn(200),AtD.suggestShow=!0,setTimeout(function(){jQuery("body").bind("click",function(){AtD.suggestShow||jQuery("#suggestmenu").fadeOut(200)})},1),setTimeout(function(){AtD.suggestShow=!1},2)},AtD._removeWords=function(a,b){return this.core.removeWords(jQuery("#"+a),b)},AtD.initCoreModule=function(){var a=new AtDCore;return a.hasClass=function(a,b){return jQuery(a).hasClass(b)},a.map=jQuery.map,a.contents=function(a){return jQuery(a).contents()},a.replaceWith=function(a,b){return jQuery(a).replaceWith(b)},a.findSpans=function(a){return jQuery.makeArray(a.find("span"))},a.create=function(b){b=b.replace(/\&/g,"&amp;"),b=b.replace(/</g,"&lt;").replace(/\>/g,"&gt;");var c,d=b.match(/\&lt;span class="hidden\w+?" pre="[^"]*"\&gt;.*?\&lt;\/span\&gt;/g);if(d)for(c=0;c<d.length;c++)b=b.replace(d[c],d[c].replace(/\&lt;/gi,"<").replace(/\&gt;/gi,">"));if(a.isIE()&&(d=b.match(/\&lt;span class="mceItemHidden"\&gt;\&amp;nbsp;\&lt;\/span&gt;/g,b)))for(c=0;c<d.length;c++)b=b.replace(d[c],d[c].replace(/\&lt;/gi,"<").replace(/\&gt;/gi,">").replace(/\&amp;/gi,"&"));var e=jQuery('<span class="mceItemHidden"></span>');return e.html(b),e},a.remove=function(a){return jQuery(a).remove()},a.removeParent=function(a){return jQuery(a).unwrap?jQuery(a).contents().unwrap():jQuery(a).replaceWith(jQuery(a).html())},a.getAttrib=function(a,b){return jQuery(a).attr(b)},a},AtD.core=AtD.initCoreModule();