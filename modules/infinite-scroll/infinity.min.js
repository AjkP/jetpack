!function($){var Scroller,ajaxurl,stats,type,text,totop,timer,isIE=-1!=navigator.userAgent.search("MSIE");if(isIE)var IEVersion=navigator.userAgent.match(/MSIE\s?(\d+)\.?\d*;/),IEVersion=parseInt(IEVersion[1]);Scroller=function(a){var b=this;this.id=a.id,this.body=$(document.body),this.window=$(window),this.element=$("#"+a.id),this.wrapperClass=a.wrapper_class,this.ready=!0,this.disabled=!1,this.page=1,this.offset=a.offset,this.currentday=a.currentday,this.order=a.order,this.throttle=!1,this.handle='<div id="infinite-handle"><span>'+text.replace("\\","")+"</span></div>",this.click_handle=a.click_handle,this.google_analytics=a.google_analytics,this.history=a.history,this.origURL=window.location.href,this.footer=$("#infinite-footer"),this.footer.wrap=a.footer,this.wpMediaelement=null,"scroll"==type?(this.window.bind("scroll.infinity",function(){this.throttle=!0}),b.gotop(),setInterval(function(){this.throttle&&(this.throttle=!1,b.thefooter(),b.refresh())},300),b.ensureFilledViewport(),this.body.bind("post-load",{self:b},b.checkViewportOnLoad)):"click"==type&&(this.click_handle&&this.element.append(this.handle),this.body.delegate("#infinite-handle","click.infinity",function(){b.click_handle&&$("#infinite-handle").remove(),b.refresh()})),this.body.bind("post-load",{self:b},b.initializeMejs)},Scroller.prototype.check=function(){var a=this.element.offset();if("object"!=typeof a)return!1;var b=this.window.scrollTop()+this.window.height(),c=a.top+this.element.outerHeight(!1)-2*this.window.height();return b>c},Scroller.prototype.render=function(a){this.body.addClass("infinity-success"),this.element.append(a.html),this.body.trigger("post-load",a),this.ready=!0},Scroller.prototype.query=function(){return{page:this.page,currentday:this.currentday,order:this.order,scripts:window.infiniteScroll.settings.scripts,styles:window.infiniteScroll.settings.styles,query_args:window.infiniteScroll.settings.query_args,last_post_date:window.infiniteScroll.settings.last_post_date}},Scroller.prototype.gotop=function(){var a=$("#infinity-blog-title");a.attr("title",totop),a.bind("click",function(a){$("html, body").animate({scrollTop:0},"fast"),a.preventDefault()})},Scroller.prototype.thefooter=function(){var a,b=this;"string"===$.type(this.footer.wrap)&&(a=$("body #"+this.footer.wrap).outerWidth(!1),a>479&&this.footer.find(".container").css("width",a)),this.window.scrollTop()>=350?b.footer.animate({bottom:0},"fast"):this.window.scrollTop()<350&&b.footer.animate({bottom:"-50px"},"fast")},Scroller.prototype.refresh=function(){var self=this,query,jqxhr,load,loader,color;if(!this.disabled&&this.ready&&this.check()){if(this.ready=!1,this.click_handle){loader='<span class="infinite-loader"></span>',this.element.append(loader),loader=this.element.find(".infinite-loader"),color=loader.css("color");try{loader.spin("medium-left",color)}catch(error){}}return query=$.extend({action:"infinite_scroll"},this.query()),jqxhr=$.post(infiniteScroll.settings.ajaxurl,query),jqxhr.fail(function(){self.click_handle&&loader.hide(),self.ready=!0}),jqxhr.done(function(response){self.click_handle&&loader.hide(),response&&(response=$.parseJSON(response),response&&response.type&&("empty"==response.type?(self.disabled=!0,self.body.addClass("infinity-end").removeClass("infinity-success")):"success"==response.type&&(response.scripts&&$(response.scripts).each(function(){var a=this.footer?"body":"head";if(window.infiniteScroll.settings.scripts.push(this.handle),this.extra_data){var b=document.createElement("script"),c=document.createTextNode("//<![CDATA[ \n"+this.extra_data+"\n//]]>");b.type="text/javascript",b.appendChild(c),document.getElementsByTagName(a)[0].appendChild(b)}var d=document.createElement("script");d.type="text/javascript",d.src=this.src,d.id=this.handle,"wp-mediaelement"===this.handle&&self.body.unbind("post-load",self.initializeMejs),"wp-mediaelement"===this.handle&&"undefined"==typeof mejs?(self.wpMediaelement={},self.wpMediaelement.tag=d,self.wpMediaelement.element=a,setTimeout(self.maybeLoadMejs.bind(self),250)):document.getElementsByTagName(a)[0].appendChild(d)}),response.styles&&$(response.styles).each(function(){window.infiniteScroll.settings.styles.push(this.handle);var style=document.createElement("link");if(style.rel="stylesheet",style.href=this.src,style.id=this.handle+"-css",this.conditional&&(!isIE||!eval(this.conditional.replace(/%ver/g,IEVersion))))var style=!1;style&&document.getElementsByTagName("head")[0].appendChild(style)}),self.page++,stats&&((new Image).src=document.location.protocol+"//stats.wordpress.com/g.gif?"+stats+"&post=0&baba="+Math.random()),"object"==typeof response.postflair&&"object"==typeof WPCOM_sharing_counts&&(WPCOM_sharing_counts=$.extend(WPCOM_sharing_counts,response.postflair)),self.render.apply(self,arguments),"click"==type&&(response.lastbatch?self.click_handle?$("#infinite-handle").remove():self.body.trigger("infinite-scroll-posts-end"):self.click_handle?self.element.append(self.handle):self.body.trigger("infinite-scroll-posts-more")),response.currentday&&(self.currentday=response.currentday),self.google_analytics&&"object"==typeof _gaq&&_gaq.push(["_trackPageview",self.history.path.replace(/%d/,self.page)]))))}),jqxhr}},Scroller.prototype.maybeLoadMejs=function(){null!==this.wpMediaelement&&("undefined"==typeof mejs?setTimeout(this.maybeLoadMejs,250):(document.getElementsByTagName(this.wpMediaelement.element)[0].appendChild(this.wpMediaelement.tag),this.wpMediaelement=null,this.body.bind("post-load",{self:this},this.initializeMejs)))},Scroller.prototype.initializeMejs=function(a,b){(-1!==b.html.indexOf("wp-audio-shortcode")||-1!==b.html.indexOf("wp-video-shortcode"))&&"undefined"!=typeof mejs&&$(function(){var a={};"undefined"!=typeof _wpmejsSettings&&(a.pluginPath=_wpmejsSettings.pluginPath),a.success=function(a){var b=a.attributes.autoplay&&"false"!==a.attributes.autoplay;"flash"===a.pluginType&&b&&a.addEventListener("canplay",function(){a.play()},!1)},$(".wp-audio-shortcode, .wp-video-shortcode").not(".mejs-container").mediaelementplayer(a)})},Scroller.prototype.ensureFilledViewport=function(){var a=this,b=a.window.height(),c=a.element.height();return aveSetHeight=0,wrapperQty=0,0===c&&($(a.element.selector+" > li").each(function(){c+=$(this).height()}),0===c)?void a.body.unbind("post-load",a.checkViewportOnLoad):($("."+a.wrapperClass).each(function(){aveSetHeight+=$(this).height(),wrapperQty++}),wrapperQty>0?aveSetHeight/=wrapperQty:aveSetHeight=0,void(b>c&&b>c+aveSetHeight?(a.ready=!0,a.refresh()):a.body.unbind("post-load",a.checkViewportOnLoad)))},Scroller.prototype.checkViewportOnLoad=function(a){a.data.self.ensureFilledViewport()},Scroller.prototype.determineURL=function(){var a=window.infiniteScroll.scroller,b=$(window).scrollTop(),c=b+$(window).height(),d=c-b,e=[],f=!1;if($("."+a.wrapperClass).each(function(){var a=$(this).attr("id"),d=$(this).offset().top,f=$(this).outerHeight(!1),g=0,h=$(this).data("page-num");0==f&&$("> *",this).each(function(){f+=$(this).outerHeight(!1)}),g=d+f,b>d&&g>c?e.push({id:a,top:d,bottom:g,pageNum:h}):d>b&&c>d?e.push({id:a,top:d,bottom:g,pageNum:h}):g>b&&c>g&&e.push({id:a,top:d,bottom:g,pageNum:h})}),0==e.length)f=-1;else if(1==e.length){var g=e.pop();f=(c-g.top)/d<.5?-1:g.pageNum}else{var h=0;$.each(e,function(a,e){var g=0,i=0,j=0;e.top>b&&e.top<c&&(g=(c-e.top)/d),e.bottom>b&&e.bottom<c&&(i=(e.bottom-b)/d),g>=i?j=g:i>=g&&(j=i),j>h&&(f=e.pageNum,h=j)})}"number"==typeof f&&(-1!=f&&f++,a.updateURL(f))},Scroller.prototype.updateURL=function(a){var b=this,c=b.offset>0?b.offset-1:0,d=-1==a?b.origURL:window.location.protocol+"//"+b.history.host+b.history.path.replace(/%d/,a+c)+b.history.parameters;window.location.href!=d&&history.pushState(null,null,d)},$(document).ready(function(){"object"==typeof infiniteScroll&&(ajaxurl=infiniteScroll.settings.ajaxurl,stats=infiniteScroll.settings.stats,type=infiniteScroll.settings.type,text=infiniteScroll.settings.text,totop=infiniteScroll.settings.totop,infiniteScroll.scroller=new Scroller(infiniteScroll.settings),(!isIE||isIE&&IEVersion>=10)&&$(window).bind("scroll",function(){clearTimeout(timer),timer=setTimeout(infiniteScroll.scroller.determineURL,100)}))})}(jQuery);