!function(a){function b(){this.galleries=[],this.findAndSetupNewGalleries()}function c(a){this.gallery=a,this.addCaptionEvents(),this.resize(),this.gallery.removeClass("tiled-gallery-unresized")}function d(b){function c(){b.resizeAll(),d&&f(c)}var d=!1,e=null;a(window).resize(function(){clearTimeout(e),d||f(c),d=!0,e=setTimeout(function(){d=!1},15)})}function e(b){a(window).resize(function(){b.resizeAll()})}b.prototype.findAndSetupNewGalleries=function(){var b=this;a(".tiled-gallery.tiled-gallery-unresized").each(function(){b.galleries.push(new c(a(this)))})},b.prototype.resizeAll=function(){a.each(this.galleries,function(a,b){b.resize()})},c.prototype.resizeableElementsSelector=".gallery-row, .gallery-group, .tiled-gallery-item img",c.prototype.addCaptionEvents=function(){this.gallery.find(".tiled-gallery-caption").hide(),this.gallery.find(".tiled-gallery-item").hover(function(){a(this).find(".tiled-gallery-caption").slideDown("fast")},function(){a(this).find(".tiled-gallery-caption").slideUp("fast")})},c.prototype.getExtraDimension=function(a,b,c){if("horizontal"===c){var d="border"==b?"borderLeftWidth":b+"Left",e="border"==b?"borderRightWidth":b+"Right";return(parseInt(a.css(d),10)||0)+(parseInt(a.css(e),10)||0)}if("vertical"===c){var f="border"==b?"borderTopWidth":b+"Top",g="border"==b?"borderBottomWidth":b+"Bottom";return(parseInt(a.css(f),10)||0)+(parseInt(a.css(g),10)||0)}return 0},c.prototype.resize=function(){var b=this.gallery.data("original-width"),c=this.gallery.parent().width(),d=Math.min(1,c/b),e=this;this.gallery.find(this.resizeableElementsSelector).each(function(){var b=a(this),c=e.getExtraDimension(b,"margin","horizontal"),f=e.getExtraDimension(b,"margin","vertical"),g=e.getExtraDimension(b,"padding","horizontal"),h=e.getExtraDimension(b,"padding","vertical"),i=e.getExtraDimension(b,"border","horizontal"),j=e.getExtraDimension(b,"border","vertical"),k=b.data("original-width")+g+i+c,l=b.data("original-height")+h+j+f;b.width(Math.floor(d*k)-c).height(Math.floor(d*l)-f)})};var f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;a(document).ready(function(){var c=new b;a("body").on("post-load",function(){c.findAndSetupNewGalleries()}),a(document).on("page-rendered.wpcom-newdash",function(){c.findAndSetupNewGalleries()}),window.chrome&&f?d(c):e(c)})}(jQuery);