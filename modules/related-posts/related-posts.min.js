!function(a){var b={response:null,getEndpointURL:function(b){var c=document.location;"string"==typeof b&&b.match(/^https?:\/\//)&&(c=document.createElement("a"),c.href=b);var d="relatedposts=1";return void 0!=a("#jp-relatedposts").data("exclude")&&(d+="&relatedposts_exclude="+a("#jp-relatedposts").data("exclude")),""==c.search?c.pathname+"?"+d:c.pathname+c.search+"&"+d},getAnchor:function(b){var c=b.title;""!=b.excerpt&&(c+="\n\n"+b.excerpt);var d=a("<a>");d.attr({"class":"jp-relatedposts-post-a",href:b.url,title:c,rel:"nofollow","data-origin":b.url_meta.origin,"data-position":b.url_meta.position});var e=a("<div>").append(d).html();return[e.substring(0,e.length-4),"</a>"]},generateMinimalHtml:function(b){var c=this,d="";return a.each(b,function(a,b){var e=c.getAnchor(b),f="jp-relatedposts-post jp-relatedposts-post"+a;d+='<p class="'+f+'" data-post-id="'+b.id+'" data-post-format="'+b.format+'">',d+='<span class="jp-relatedposts-post-title">'+e[0]+b.title+e[1]+"</span>",d+='<span class="jp-relatedposts-post-context">'+b.context+"</span>",d+="</p>"}),'<div class="jp-relatedposts-items jp-relatedposts-items-minimal">'+d+"</div>"},generateVisualHtml:function(b){var c=this,d="";return a.each(b,function(a,b){var e=c.getAnchor(b),f="jp-relatedposts-post jp-relatedposts-post"+a;f+=""==b.img.src?" jp-relatedposts-post-nothumbs":" jp-relatedposts-post-thumbs",d+='<div class="'+f+'" data-post-id="'+b.id+'" data-post-format="'+b.format+'">',""!=b.img.src&&(d+=e[0]+'<img class="jp-relatedposts-post-img" src="'+b.img.src+'" width="'+b.img.width+'" alt="'+b.title+'" />'+e[1]),d+='<h4 class="jp-relatedposts-post-title">'+e[0]+b.title+e[1]+"</h4>",d+='<p class="jp-relatedposts-post-excerpt">'+b.excerpt+"</p>",d+='<p class="jp-relatedposts-post-context">'+b.context+"</p>",d+="</div>"}),'<div class="jp-relatedposts-items jp-relatedposts-items-visual">'+d+"</div>"},getTrackedUrl:function(b){var c="relatedposts_hit=1";return c+="&relatedposts_origin="+a(b).data("origin"),c+="&relatedposts_position="+a(b).data("position"),""==b.search?b.pathname+"?"+c:b.pathname+b.search+"&"+c},cleanupTrackedUrl:function(){if("function"==typeof history.replaceState){var a=document.location.search.replace(/\brelatedposts_[a-z]+=[0-9]*&?\b/gi,"");"?"==a&&(a=""),document.location.search!=a&&history.replaceState({},document.title,document.location.pathname+a)}}};a(function(){b.cleanupTrackedUrl(),a.getJSON(b.getEndpointURL(),function(c){if(0!=c.items.length&&0!=a("#jp-relatedposts").length){b.response=c;var d="";d=c.show_thumbnails?b.generateVisualHtml(c.items):b.generateMinimalHtml(c.items),a("#jp-relatedposts").append(d).show(),a("#jp-relatedposts a.jp-relatedposts-post-a").click(function(){this.href=b.getTrackedUrl(this)})}})})}(jQuery);